---

# Temporary directory used to store the keyfiles for LUKS encrypted devices
keyfile_path: '/root/luk_keyfiles'

# Disks that will be worked on. The partitions on these disks will be erased.
disks:
  - '/dev/sda'
  - '/dev/sdb'

# List of dictionaries of partitions that will be created on both disks.
#
# Each entry of the list can contain any parameter that the "parted" module
# for Ansible is able to manage.
#
# See:
# https://docs.ansible.com/ansible/latest/modules/parted_module.html
partitions:
  - name: 'efi'
    part_start: '1MiB'
    part_end: '513MiB'
    part_type: 'primary'
    unit: 'MiB'
    flags: ['esp']
  - name: 'boot'
    part_start: '513MiB'
    part_end: '1025MiB'
    part_type: 'primary'
    unit: 'MiB'
    flags: ['raid']
  - name: 'swap'
    part_start: '1025MiB'
    part_end: '2047MiB'
    part_type: 'primary'
    unit: 'MiB'
    flags: ['raid']
  - name: 'root'
    part_start: '2047MiB'
    part_end: '100%'
    part_type: 'primary'
    unit: 'MiB'
    flags: ['raid']

# List of dictionaries of raid devices that will be set up.
#
# Format:
#
# - name: device name on /dev for the array
#   devices: list of paths to the partitions that will be forming the array
#   level: raid level of the array
#   metadata: metadata level of the array
# - name: another partition
#   ...
raid_arrays:
  - name: 'md0'
    devices: ['/dev/sda2', '/dev/sdb2']
    level: 'raid1'
    metadata: '0.9'
  - name: 'md1'
    devices: ['/dev/sda3', '/dev/sdb3']
    level: 'raid0'
  - name: 'md2'
    devices: ['/dev/sda4', '/dev/sdb4']
    level: 'raid0'

# List of dictionaries of LUKS devices that will be created.
#
# Each individual dictionary may use any parameter defined in the
# "luks_device_reloaded" module which is found on the "library/" directory of
# this playbook. Mind that it is based on the community "luks_device" Ansible
# module and, as such, is able to use any of its parameter (link below).
#
# The "type" parameter is specifically added to the luks_device_reloaded module
# and allows to use any other LUKS encryption type (such as LUKS1, needed if you
# want to encrypt a GRUB partition, as it doesn't have LUKS2 capabilities).
#
# You can also specify a "password" key on each entry in which case the playbook
# will add that passphrase to the LUKS device. If you do this I recommend you to
# encrypt your passwords with Ansible Vault so that they are not here in
# plaintext.
#
# If either keyfile or password are ommited, they won't be used.
#
# See:
# https://docs.ansible.com/ansible/latest/modules/luks_device_module.html
luks_devices:
  - name: 'LUKS_BOOT'
    device: '/dev/md0'
    keyfile: 'default'
    password: 'boot'
    type: 'luks1'
  - name: 'LUKS_SWAP'
    device: '/dev/md1'
    keyfile: 'default'
    password: 'swap'
  - name: 'LUKS_ROOT'
    device: '/dev/md2'
    keyfile: 'default'
    password: 'root'

# List of dictionaries of filesystems to create.
#
# Each entry of the list can use any key compatible with the filesystem
# Ansible module.
#
# See:
# https://docs.ansible.com/ansible/latest/modules/filesystem_module.html
filesystems:
  - dev: '/dev/sda1'
    fstype: 'vfat'
    opts: '-F32'
  - dev: '/dev/mapper/LUKS_BOOT'
    fstype: 'ext4'
  - dev: '/dev/mapper/LUKS_SWAP'
    fstype: 'swap'
  - dev: '/dev/mapper/LUKS_ROOT'
    fstype: 'ext4'
